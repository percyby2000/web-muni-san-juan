---
// filepath: d:\muni san juan\muni_san_juan\src\components\Navbar.astro
const menus = [
  {
    title: "LA MUNICIPALIDAD",
    items: [
      { name: "Gestión", url: "/municipalidad/gestion" },
      { name: "Gerencias", url: "/municipalidad/gerencias" },
      { name: "Empresas Municipales y Órganos Desconcentrados Especiales", url: "/municipalidad/empresas-municipales" },
      { name: "Funcionarios", url: "/municipalidad/funcionarios" },
      { name: "Concejo Municipal", url: "/municipalidad/concejo-municipal" },
      { name: "Organigrama", url: "/municipalidad/organigrama" },
      { name: "Reconocimientos", url: "/municipalidad/reconocimientos" },
      { name: "Gobierno Abierto", url: "/municipalidad/gobierno-abierto" },
      { name: "Gobierno Electrónico Municipal", url: "/municipalidad/gobierno-electronico" },
      { name: "Sistema Integrado de Gestión – SIG", url: "/municipalidad/sig" },
      { name: "Normas emitidas", url: "/municipalidad/normas-emitidas" },
      { name: "Rendición de cuentas 2023–2026", url: "/municipalidad/rendicion-cuentas" },
      { name: "Presupuesto Participativo 2026", url: "/municipalidad/presupuesto-participativo" },
      { name: "Prepublicación de Ordenanzas", url: "/municipalidad/prepublicacion-ordenanzas" }
    ]
  },
  {
    title: "MI CIUDAD",
    items: [
      { name: "San Juan Bautista", url: "/sjb" },
      { name: "Obras para San Juan Bautista", url: "/mi-ciudad/obras" },
      { name: "Obras sociales", url: "/mi-ciudad/obras-sociales" },
      { name: "Seguridad", url: "/mi-ciudad/seguridad" },
      { name: "Tránsito", url: "/mi-ciudad/transito" },
      { name: "Agenda cultural", url: "/mi-ciudad/agenda-cultural" }
    ]
  },
  {
    title: "TRÁMITES Y SERVICIOS",
    items: [
      { name: "Directorio de trámites y servicios", url: "/tramites/directorio" },
      { name: "Más buscados ▶", url: "/tramites/mas-buscados" },
      { name: "Servicios en línea ▶", url: "/tramites/servicios-en-linea" },
      { name: "Canal de Denuncias", url: "/tramites/denuncias" },
      { name: "Licencias de funcionamiento", url: "/tramites/licencias" },
      { name: "Trámites de desarrollo urbano", url: "/tramites/desarrollo-urbano" },
      { name: "Reclamos y sugerencias", url: "/reclamaciones" },
      { name: "TUPA", url: "/tramites/tupa" },
      { name: "Biblioteca municipal", url: "/tramites/biblioteca" },
      { name: "Bolsa laboral", url: "/tramites/bolsa-laboral" }
    ]
  },
  {
    title: "NOTICIAS",
    items: [
      { name: "Últimas noticias", url: "/noticias" },
      { name: "Notas de prensa", url: "/noticias/notas-prensa" },
      { name: "Eventos", url: "/noticias/eventos" },
      { name: "Comunicados oficiales", url: "/noticias/comunicados" }
    ]
  }
];
---

<header class="bg-white shadow-md relative z-50 w-full">

  <!-- HEADER SUPERIOR -->
  <div class="max-w-7xl mx-auto flex items-center justify-between px-4 sm:px-6 lg:px-8 py-4">

    <!-- LOGO -->
    <a href="/" class="flex items-center gap-3">
      <img src="/logoSanJuan.png" class="h-12 sm:h-14 md:h-16 w-auto" alt="Municipalidad de San Juan Bautista">
    </a>

    <!-- BUSCADOR + MOBILE TOGGLE -->
    <div class="flex items-center gap-3">
      <div class="relative hidden sm:block">
        <form action="/buscar" method="GET">
          <input 
            type="text"
            name="q"
            placeholder="Buscar en el sitio..."
            class="border-2 border-blue-100 rounded-lg px-4 py-2 pr-10 text-sm w-64 lg:w-80 focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all"
          >
          <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2" aria-label="Buscar">
            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </button>
        </form>
      </div>

      <!-- BOTÓN MÓVIL -->
      <button 
        id="mobile-menu-btn"
        class="lg:hidden p-2 rounded-lg hover:bg-blue-50 transition-colors"
        aria-label="Abrir menú"
      >
        <svg class="w-6 h-6 text-blue-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

  </div>

  <!-- BUSCADOR MÓVIL -->
  <div class="sm:hidden px-4 pb-4">
    <form action="/buscar" method="GET">
      <div class="relative">
        <input 
          type="text"
          name="q"
          placeholder="Buscar..."
          class="w-full border-2 border-blue-100 rounded-lg px-4 py-2 pr-10 text-sm focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-200 transition-all"
        >
        <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2" aria-label="Buscar">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>
      </div>
    </form>
  </div>

  <!-- MENU DESKTOP -->
  <nav class="bg-white border-t border-blue-100 hidden lg:block">
    <ul class="max-w-7xl mx-auto flex items-center justify-center gap-1 px-4">
      {menus.map(menu => (
        <li class="group relative">
          <button class="flex items-center gap-1.5 py-4 px-5 text-blue-900 font-semibold text-sm uppercase tracking-wide hover:text-blue-600 hover:bg-blue-50 rounded-t-lg transition-all duration-200">
            {menu.title}
            <svg 
              xmlns="http://www.w3.org/2000/svg"
              class="w-4 h-4 transition-transform duration-200 group-hover:rotate-180"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path d="M1.5 6l6 6 6-6"/>
            </svg>
          </button>

          <!-- DROPDOWN -->
          <div class="absolute left-0 top-full bg-white shadow-xl border border-blue-100 rounded-b-lg overflow-hidden opacity-0 invisible group-hover:opacity-100 group-hover:visible group-hover:translate-y-0 translate-y-2 transition-all duration-300 ease-out w-[440px] max-h-[70vh] overflow-y-auto">
            <ul class="py-2">
              {menu.items.map(item => (
                <li>
                  <a
                    href={item.url}
                    class="block px-6 py-3 text-blue-900 hover:bg-blue-50 hover:text-blue-600 transition-colors text-sm border-l-4 border-transparent hover:border-blue-600"
                  >
                    {item.name}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        </li>
      ))}
    </ul>
  </nav>

  <!-- MENU MÓVIL -->
  <nav id="mobile-menu" class="lg:hidden bg-white border-t border-blue-100 max-h-0 overflow-hidden transition-all duration-300 ease-in-out">
    <div class="px-4 py-2">
      {menus.map((menu, menuIndex) => (
        <div class="border-b border-blue-50 last:border-0">
          <button 
            class="mobile-menu-item w-full flex items-center justify-between py-4 text-blue-900 font-semibold text-sm uppercase"
            data-menu={menuIndex}
          >
            {menu.title}
            <svg 
              class="mobile-arrow w-5 h-5 transition-transform duration-200"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path d="M1.5 6l6 6 6-6"/>
            </svg>
          </button>
          
          <div class="mobile-submenu max-h-0 overflow-hidden transition-all duration-300">
            <ul class="pb-2">
              {menu.items.map(item => (
                <li>
                  <a
                    href={item.url}
                    class="block py-2.5 pl-4 pr-2 text-blue-800 text-sm hover:bg-blue-50 hover:text-blue-600 rounded transition-colors"
                  >
                    {item.name}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        </div>
      ))}
    </div>
  </nav>

</header>

<style>
  /* Scrollbar personalizado para dropdowns */
  .overflow-y-auto::-webkit-scrollbar {
    width: 6px;
  }
  
  .overflow-y-auto::-webkit-scrollbar-track {
    background: #f1f5f9;
  }
  
  .overflow-y-auto::-webkit-scrollbar-thumb {
    background: #3b82f6;
    border-radius: 3px;
  }
  
  .overflow-y-auto::-webkit-scrollbar-thumb:hover {
    background: #2563eb;
  }
</style>

<script>
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuItems = document.querySelectorAll('.mobile-menu-item');

  // Toggle menú móvil principal
  mobileMenuBtn?.addEventListener('click', () => {
    const isOpen = mobileMenu?.style.maxHeight && mobileMenu.style.maxHeight !== '0px';
    
    if (isOpen) {
      mobileMenu.style.maxHeight = '0px';
    } else {
      mobileMenu!.style.maxHeight = mobileMenu!.scrollHeight + 'px';
    }
  });

  // Toggle submenús móviles
  mobileMenuItems.forEach(item => {
    item.addEventListener('click', () => {
      const submenu = item.nextElementSibling as HTMLElement;
      const arrow = item.querySelector('.mobile-arrow') as HTMLElement;
      const isOpen = submenu.style.maxHeight && submenu.style.maxHeight !== '0px';

      // Cerrar todos los otros submenús
      document.querySelectorAll('.mobile-submenu').forEach(sub => {
        if (sub !== submenu) {
          (sub as HTMLElement).style.maxHeight = '0px';
          const otherArrow = sub.previousElementSibling?.querySelector('.mobile-arrow') as HTMLElement;
          otherArrow?.classList.remove('rotate-180');
        }
      });

      // Toggle el actual
      if (isOpen) {
        submenu.style.maxHeight = '0px';
        arrow?.classList.remove('rotate-180');
      } else {
        submenu.style.maxHeight = submenu.scrollHeight + 'px';
        arrow?.classList.add('rotate-180');
        
        // Ajustar altura del menú principal
        setTimeout(() => {
          if (mobileMenu) {
            mobileMenu.style.maxHeight = mobileMenu.scrollHeight + 'px';
          }
        }, 300);
      }
    });
  });

  // Cerrar menú móvil al hacer click fuera
  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    if (mobileMenu && !mobileMenu.contains(target) && !mobileMenuBtn?.contains(target)) {
      mobileMenu.style.maxHeight = '0px';
      
      // Cerrar todos los submenús
      document.querySelectorAll('.mobile-submenu').forEach(sub => {
        (sub as HTMLElement).style.maxHeight = '0px';
      });
      document.querySelectorAll('.mobile-arrow').forEach(arrow => {
        arrow.classList.remove('rotate-180');
      });
    }
  });
</script>